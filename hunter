#!/usr/bin/env python3

"""Hunt for sex-specific transcripts in male/female assemblies.

What are we looking for?

=> Is it full of SNPs (rather than a splice variant)?

BLAST back against male assembly

=> Is there a higher identity hit could be an X allele?
"""

import os
import fasta
from blast.blast import blast
from blast.parse import BlastResult

import logging
import logging.config
logging.config.fileConfig('logging/log.conf')
logger = logging.getLogger('root')


# Sequences to use as BLAST queries
MSP_cds = "data/MSP_cds.fas"
MSP_pep = "data/MSP_pep.fas"
FSP_cds = "data/FSP_cds.fas"
FSP_pep = "data/FSP_pep.fas"

# Assemblies to BLAST against
male_hp_cds = "blast/db/hp_m_cds.fas"
female_hp_cds = "blast/db/hp_f_cds.fas"
male_hp_pep = "blast/db/hp_m_pep.fas"
female_hp_pep = "blast/db/hp_f_pep.fas"

# %% Generate BLAST alignments

outfiles = []

blast_combos = [
    ("blastn", MSP_cds, female_hp_cds),
    ("blastn", FSP_cds, male_hp_cds),
    ("blastp", MSP_pep, female_hp_pep),
    ("blastp", FSP_pep, male_hp_pep),
]

for alg, query, db in blast_combos:
    outfile = blast(alg, query, db)
    outfiles.append(outfile)

# %% Filter alignments
# **optional

# %% Write output

for outfile in outfiles:
    csvfile = os.path.basename(outfile.replace('.xml', '.csv'))
    result = BlastResult(outfile)
    result.to_csv(csvfile)
